{"version":3,"file":"react-css-theme-switcher.cjs.production.min.js","sources":["../src/index.tsx","../src/utils.ts"],"sourcesContent":["import * as React from 'react';\nimport {\n  findCommentNode,\n  arrayToObject,\n  createLinkElement,\n  isElement,\n} from './utils';\n\nenum Status {\n  idle = 'idle',\n  loading = 'loading',\n  loaded = 'loaded',\n}\n\ninterface IThemeSwitcherContext {\n  currentTheme: string | undefined;\n  themes: Record<any, string>;\n  switcher: ({ theme }: { theme: string }) => void;\n  status: Status;\n}\n\nconst ThemeSwitcherContext = React.createContext<\n  IThemeSwitcherContext | undefined\n>(undefined);\n\ninterface Props {\n  themeMap: Record<any, string>;\n  children?: React.ReactNode;\n  insertionPoint?: string | HTMLElement | null;\n  id?: string;\n  defaultTheme?: string;\n  attr?: string;\n}\n\nexport function ThemeSwitcherProvider({\n  themeMap,\n  insertionPoint,\n  defaultTheme,\n  id = 'current-theme-style',\n  attr = 'data-theme',\n  ...rest\n}: Props) {\n  const [status, setStatus] = React.useState<Status>(Status.idle);\n  const [currentTheme, setCurrentTheme] = React.useState<string>();\n\n  const insertStyle = React.useCallback(\n    (linkElement: HTMLElement): HTMLElement | void => {\n      if (insertionPoint || insertionPoint === null) {\n        const insertionPointElement = isElement(insertionPoint)\n          ? (insertionPoint as HTMLElement)\n          : findCommentNode(insertionPoint as string);\n\n        if (!insertionPointElement) {\n          console.warn(\n            `Insertion point '${insertionPoint}' does not exist. Be sure to add comment on head and that it matches the insertionPoint`\n          );\n          return document.head.appendChild(linkElement);\n        }\n\n        const { parentNode } = insertionPointElement;\n        if (parentNode) {\n          return parentNode.insertBefore(\n            linkElement,\n            insertionPointElement.nextSibling\n          );\n        }\n      } else {\n        return document.head.appendChild(linkElement);\n      }\n    },\n    [insertionPoint]\n  );\n\n  const switcher = React.useCallback(\n    ({ theme }: { theme: string }) => {\n      if (theme === currentTheme) return;\n\n      const previousStyle = document.getElementById(id);\n      if (previousStyle) {\n        previousStyle.remove();\n      }\n\n      if (themeMap[theme]) {\n        setStatus(Status.loading);\n\n        const linkElement = createLinkElement({\n          type: 'text/css',\n          rel: 'stylesheet',\n          id: id,\n          href: themeMap[theme],\n          onload: () => {\n            setStatus(Status.loaded);\n          },\n        });\n\n        insertStyle(linkElement);\n        setCurrentTheme(theme);\n      } else {\n        return console.warn('Could not find specified theme');\n      }\n\n      document.body.setAttribute(attr, theme);\n    },\n    [themeMap, insertStyle, attr, id, currentTheme]\n  );\n\n  React.useEffect(() => {\n    if (defaultTheme) {\n      switcher({ theme: defaultTheme });\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [defaultTheme]);\n\n  React.useEffect(() => {\n    const themes = Object.keys(themeMap);\n\n    themes.map(theme => {\n      const themeAssetId = `theme-prefetch-${theme}`;\n      if (!document.getElementById(themeAssetId)) {\n        const stylePrefetch = document.createElement('link');\n        stylePrefetch.rel = 'prefetch';\n        stylePrefetch.type = 'text/css';\n        stylePrefetch.id = themeAssetId;\n        stylePrefetch.href = themeMap[theme];\n\n        insertStyle(stylePrefetch);\n      }\n      return '';\n    });\n  }, [themeMap, insertStyle]);\n\n  const value = React.useMemo(\n    () => ({\n      switcher,\n      status,\n      currentTheme,\n      themes: arrayToObject(Object.keys(themeMap)),\n    }),\n    [switcher, status, currentTheme, themeMap]\n  );\n\n  return <ThemeSwitcherContext.Provider value={value} {...rest} />;\n}\n\nexport function useThemeSwitcher() {\n  const context = React.useContext(ThemeSwitcherContext);\n  if (!context) {\n    throw new Error(\n      'To use `useThemeSwitcher`, component must be within a ThemeSwitcherProvider'\n    );\n  }\n  return context;\n}\n","export function findCommentNode(comment: string) {\n  const head = document.head;\n  for (let i = 0; i < head.childNodes.length; i++) {\n    const node = head.childNodes[i];\n    if (node.nodeType === 8 && node?.nodeValue?.trim() === comment) {\n      return node;\n    }\n  }\n  return null;\n}\n\nexport function isElement(o: any) {\n  return typeof HTMLElement === 'object'\n    ? o instanceof HTMLElement //DOM2\n    : o &&\n        typeof o === 'object' &&\n        o !== null &&\n        o.nodeType === 1 &&\n        typeof o.nodeName === 'string';\n}\n\nexport function arrayToObject(array: string[]): Record<any, string> {\n  const obj: Record<any, string> = {};\n  array.forEach(el => (obj[el] = el));\n  return obj;\n}\n\nexport function createLinkElement(attributes: Record<string, any>) {\n  const linkElement = document.createElement('link');\n\n  for (const [attribute, value] of Object.entries(attributes)) {\n    if (attribute === 'onload') {\n      linkElement.onload = attributes.onload;\n      continue;\n    }\n\n    // @ts-ignore\n    linkElement[attribute] = value;\n  }\n\n  return linkElement;\n}\n"],"names":["Status","ThemeSwitcherContext","React","undefined","themeMap","insertionPoint","defaultTheme","id","attr","rest","idle","status","setStatus","currentTheme","setCurrentTheme","insertStyle","linkElement","document","head","appendChild","insertionPointElement","o","HTMLElement","nodeType","nodeName","comment","i","childNodes","length","node","nodeValue","trim","findCommentNode","console","warn","parentNode","insertBefore","nextSibling","switcher","theme","previousStyle","getElementById","remove","loading","attributes","createElement","Object","entries","attribute","onload","createLinkElement","type","rel","href","loaded","body","setAttribute","keys","map","themeAssetId","stylePrefetch","value","themes","array","obj","forEach","el","Provider","context","Error"],"mappings":"wEAQKA,sBAAL,SAAKA,GACHA,cACAA,oBACAA,kBAHF,CAAKA,IAAAA,OAaL,IAAMC,EAAuBC,qBAE3BC,iDAYAC,IAAAA,SACAC,IAAAA,eACAC,IAAAA,iBACAC,GAAAA,aAAK,4BACLC,KAAAA,aAAO,eACJC,mMAEyBP,WAAuBF,EAAOU,MAAnDC,OAAQC,SACyBV,aAAjCW,OAAcC,OAEfC,EAAcb,eAClB,SAACc,OACKX,GAAqC,OAAnBA,SAoBbY,SAASC,KAAKC,YAAYH,OAnB3BI,GCrCYC,EDqCsBhB,GCpChB,iBAAhBiB,YACVD,aAAaC,YACbD,GACe,iBAANA,GACD,OAANA,GACe,IAAfA,EAAEE,UACoB,iBAAfF,EAAEG,UD+BJnB,WCjDmBoB,WACxBP,EAAOD,SAASC,KACbQ,EAAI,EAAGA,EAAIR,EAAKS,WAAWC,OAAQF,IAAK,OACzCG,EAAOX,EAAKS,WAAWD,MACP,IAAlBG,EAAKN,iBAAkBM,YAAAA,EAAMC,oBAAWC,UAAWN,SAC9CI,SAGJ,KD0CGG,CAAgB3B,QAEfe,SACHa,QAAQC,yBACc7B,6FAEfY,SAASC,KAAKC,YAAYH,OC7CjBK,EDgDVc,EAAef,EAAfe,kBACJA,EACKA,EAAWC,aAChBpB,EACAI,EAAsBiB,sBAO9B,CAAChC,IAGGiC,EAAWpC,eACf,gBAAGqC,IAAAA,SACGA,IAAU1B,OAER2B,EAAgBvB,SAASwB,eAAelC,MAC1CiC,GACFA,EAAcE,UAGZtC,EAASmC,UAgBJN,QAAQC,KAAK,kCAfpBtB,EAAUZ,EAAO2C,aAEX3B,WC1DoB4B,WAC1B5B,EAAcC,SAAS4B,cAAc,cAEVC,OAAOC,QAAQH,kBAAa,YAAjDI,OACQ,WAAdA,EAMJhC,EAAYgC,QALVhC,EAAYiC,OAASL,EAAWK,cAQ7BjC,ED6CmBkC,CAAkB,CACpCC,KAAM,WACNC,IAAK,aACL7C,GAAIA,EACJ8C,KAAMjD,EAASmC,GACfU,OAAQ,WACNrC,EAAUZ,EAAOsD,WAIrBvC,EAAYC,GACZF,EAAgByB,GAKlBtB,SAASsC,KAAKC,aAAahD,EAAM+B,MAEnC,CAACnC,EAAUW,EAAaP,EAAMD,EAAIM,IAGpCX,aAAgB,WACVI,GACFgC,EAAS,CAAEC,MAAOjC,MAGnB,CAACA,IAEJJ,aAAgB,WACC4C,OAAOW,KAAKrD,GAEpBsD,KAAI,SAAAnB,OACHoB,oBAAiCpB,MAClCtB,SAASwB,eAAekB,GAAe,KACpCC,EAAgB3C,SAAS4B,cAAc,QAC7Ce,EAAcR,IAAM,WACpBQ,EAAcT,KAAO,WACrBS,EAAcrD,GAAKoD,EACnBC,EAAcP,KAAOjD,EAASmC,GAE9BxB,EAAY6C,SAEP,QAER,CAACxD,EAAUW,QAER8C,EAAQ3D,WACZ,iBAAO,CACLoC,SAAAA,EACA3B,OAAAA,EACAE,aAAAA,EACAiD,QCnHwBC,EDmHFjB,OAAOW,KAAKrD,GClHhC4D,EAA2B,GACjCD,EAAME,SAAQ,SAAAC,UAAOF,EAAIE,GAAMA,KACxBF,QAHqBD,EACtBC,IDoHJ,CAAC1B,EAAU3B,EAAQE,EAAcT,WAG5BF,gBAACD,EAAqBkE,wBAASN,MAAOA,GAAWpD,8BAG1D,eACQ2D,EAAUlE,aAAiBD,OAC5BmE,QACG,IAAIC,MACR,sFAGGD"}