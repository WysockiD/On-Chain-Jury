{"ast":null,"code":"// CodeMirror, copyright (c) by Marijn Haverbeke and others\n// Distributed under an MIT license: https://codemirror.net/LICENSE\n// Define search commands. Depends on dialog.js or another\n// implementation of the openDialog method.\n// Replace works a little oddly -- it will do the replace on the next\n// Ctrl-G (or whatever is bound to findNext) press. You prevent a\n// replace by making sure the match is no longer selected when hitting\n// Ctrl-G.\n(function (mod) {\n  if (typeof exports == \"object\" && typeof module == \"object\") // CommonJS\n    mod(require(\"../../lib/codemirror\"), require(\"./searchcursor\"), require(\"../dialog/dialog\"));else if (typeof define == \"function\" && define.amd) // AMD\n    define([\"../../lib/codemirror\", \"./searchcursor\", \"../dialog/dialog\"], mod);else // Plain browser env\n    mod(CodeMirror);\n})(function (CodeMirror) {\n  \"use strict\";\n\n  function searchOverlay(query, caseInsensitive) {\n    if (typeof query == \"string\") query = new RegExp(query.replace(/[\\-\\[\\]\\/\\{\\}\\(\\)\\*\\+\\?\\.\\\\\\^\\$\\|]/g, \"\\\\$&\"), caseInsensitive ? \"gi\" : \"g\");else if (!query.global) query = new RegExp(query.source, query.ignoreCase ? \"gi\" : \"g\");\n    return {\n      token: function (stream) {\n        query.lastIndex = stream.pos;\n        var match = query.exec(stream.string);\n\n        if (match && match.index == stream.pos) {\n          stream.pos += match[0].length || 1;\n          return \"searching\";\n        } else if (match) {\n          stream.pos = match.index;\n        } else {\n          stream.skipToEnd();\n        }\n      }\n    };\n  }\n\n  function SearchState() {\n    this.posFrom = this.posTo = this.lastQuery = this.query = null;\n    this.overlay = null;\n  }\n\n  function getSearchState(cm) {\n    return cm.state.search || (cm.state.search = new SearchState());\n  }\n\n  function queryCaseInsensitive(query) {\n    return typeof query == \"string\" && query == query.toLowerCase();\n  }\n\n  function getSearchCursor(cm, query, pos) {\n    // Heuristic: if the query string is all lowercase, do a case insensitive search.\n    return cm.getSearchCursor(query, pos, {\n      caseFold: queryCaseInsensitive(query),\n      multiline: true\n    });\n  }\n\n  function persistentDialog(cm, text, deflt, onEnter, onKeyDown) {\n    cm.openDialog(text, onEnter, {\n      value: deflt,\n      selectValueOnOpen: true,\n      closeOnEnter: false,\n      onClose: function () {\n        clearSearch(cm);\n      },\n      onKeyDown: onKeyDown\n    });\n  }\n\n  function dialog(cm, text, shortText, deflt, f) {\n    if (cm.openDialog) cm.openDialog(text, f, {\n      value: deflt,\n      selectValueOnOpen: true\n    });else f(prompt(shortText, deflt));\n  }\n\n  function confirmDialog(cm, text, shortText, fs) {\n    if (cm.openConfirm) cm.openConfirm(text, fs);else if (confirm(shortText)) fs[0]();\n  }\n\n  function parseString(string) {\n    return string.replace(/\\\\([nrt\\\\])/g, function (match, ch) {\n      if (ch == \"n\") return \"\\n\";\n      if (ch == \"r\") return \"\\r\";\n      if (ch == \"t\") return \"\\t\";\n      if (ch == \"\\\\\") return \"\\\\\";\n      return match;\n    });\n  }\n\n  function parseQuery(query) {\n    var isRE = query.match(/^\\/(.*)\\/([a-z]*)$/);\n\n    if (isRE) {\n      try {\n        query = new RegExp(isRE[1], isRE[2].indexOf(\"i\") == -1 ? \"\" : \"i\");\n      } catch (e) {} // Not a regular expression after all, do a string search\n\n    } else {\n      query = parseString(query);\n    }\n\n    if (typeof query == \"string\" ? query == \"\" : query.test(\"\")) query = /x^/;\n    return query;\n  }\n\n  function startSearch(cm, state, query) {\n    state.queryText = query;\n    state.query = parseQuery(query);\n    cm.removeOverlay(state.overlay, queryCaseInsensitive(state.query));\n    state.overlay = searchOverlay(state.query, queryCaseInsensitive(state.query));\n    cm.addOverlay(state.overlay);\n\n    if (cm.showMatchesOnScrollbar) {\n      if (state.annotate) {\n        state.annotate.clear();\n        state.annotate = null;\n      }\n\n      state.annotate = cm.showMatchesOnScrollbar(state.query, queryCaseInsensitive(state.query));\n    }\n  }\n\n  function doSearch(cm, rev, persistent, immediate) {\n    var state = getSearchState(cm);\n    if (state.query) return findNext(cm, rev);\n    var q = cm.getSelection() || state.lastQuery;\n    if (q instanceof RegExp && q.source == \"x^\") q = null;\n\n    if (persistent && cm.openDialog) {\n      var hiding = null;\n\n      var searchNext = function (query, event) {\n        CodeMirror.e_stop(event);\n        if (!query) return;\n\n        if (query != state.queryText) {\n          startSearch(cm, state, query);\n          state.posFrom = state.posTo = cm.getCursor();\n        }\n\n        if (hiding) hiding.style.opacity = 1;\n        findNext(cm, event.shiftKey, function (_, to) {\n          var dialog;\n          if (to.line < 3 && document.querySelector && (dialog = cm.display.wrapper.querySelector(\".CodeMirror-dialog\")) && dialog.getBoundingClientRect().bottom - 4 > cm.cursorCoords(to, \"window\").top) (hiding = dialog).style.opacity = .4;\n        });\n      };\n\n      persistentDialog(cm, getQueryDialog(cm), q, searchNext, function (event, query) {\n        var keyName = CodeMirror.keyName(event);\n        var extra = cm.getOption('extraKeys'),\n            cmd = extra && extra[keyName] || CodeMirror.keyMap[cm.getOption(\"keyMap\")][keyName];\n\n        if (cmd == \"findNext\" || cmd == \"findPrev\" || cmd == \"findPersistentNext\" || cmd == \"findPersistentPrev\") {\n          CodeMirror.e_stop(event);\n          startSearch(cm, getSearchState(cm), query);\n          cm.execCommand(cmd);\n        } else if (cmd == \"find\" || cmd == \"findPersistent\") {\n          CodeMirror.e_stop(event);\n          searchNext(query, event);\n        }\n      });\n\n      if (immediate && q) {\n        startSearch(cm, state, q);\n        findNext(cm, rev);\n      }\n    } else {\n      dialog(cm, getQueryDialog(cm), \"Search for:\", q, function (query) {\n        if (query && !state.query) cm.operation(function () {\n          startSearch(cm, state, query);\n          state.posFrom = state.posTo = cm.getCursor();\n          findNext(cm, rev);\n        });\n      });\n    }\n  }\n\n  function findNext(cm, rev, callback) {\n    cm.operation(function () {\n      var state = getSearchState(cm);\n      var cursor = getSearchCursor(cm, state.query, rev ? state.posFrom : state.posTo);\n\n      if (!cursor.find(rev)) {\n        cursor = getSearchCursor(cm, state.query, rev ? CodeMirror.Pos(cm.lastLine()) : CodeMirror.Pos(cm.firstLine(), 0));\n        if (!cursor.find(rev)) return;\n      }\n\n      cm.setSelection(cursor.from(), cursor.to());\n      cm.scrollIntoView({\n        from: cursor.from(),\n        to: cursor.to()\n      }, 20);\n      state.posFrom = cursor.from();\n      state.posTo = cursor.to();\n      if (callback) callback(cursor.from(), cursor.to());\n    });\n  }\n\n  function clearSearch(cm) {\n    cm.operation(function () {\n      var state = getSearchState(cm);\n      state.lastQuery = state.query;\n      if (!state.query) return;\n      state.query = state.queryText = null;\n      cm.removeOverlay(state.overlay);\n\n      if (state.annotate) {\n        state.annotate.clear();\n        state.annotate = null;\n      }\n    });\n  }\n\n  function getQueryDialog(cm) {\n    return '<span class=\"CodeMirror-search-label\">' + cm.phrase(\"Search:\") + '</span> <input type=\"text\" style=\"width: 10em\" class=\"CodeMirror-search-field\"/> <span style=\"color: #888\" class=\"CodeMirror-search-hint\">' + cm.phrase(\"(Use /re/ syntax for regexp search)\") + '</span>';\n  }\n\n  function getReplaceQueryDialog(cm) {\n    return ' <input type=\"text\" style=\"width: 10em\" class=\"CodeMirror-search-field\"/> <span style=\"color: #888\" class=\"CodeMirror-search-hint\">' + cm.phrase(\"(Use /re/ syntax for regexp search)\") + '</span>';\n  }\n\n  function getReplacementQueryDialog(cm) {\n    return '<span class=\"CodeMirror-search-label\">' + cm.phrase(\"With:\") + '</span> <input type=\"text\" style=\"width: 10em\" class=\"CodeMirror-search-field\"/>';\n  }\n\n  function getDoReplaceConfirm(cm) {\n    return '<span class=\"CodeMirror-search-label\">' + cm.phrase(\"Replace?\") + '</span> <button>' + cm.phrase(\"Yes\") + '</button> <button>' + cm.phrase(\"No\") + '</button> <button>' + cm.phrase(\"All\") + '</button> <button>' + cm.phrase(\"Stop\") + '</button> ';\n  }\n\n  function replaceAll(cm, query, text) {\n    cm.operation(function () {\n      for (var cursor = getSearchCursor(cm, query); cursor.findNext();) {\n        if (typeof query != \"string\") {\n          var match = cm.getRange(cursor.from(), cursor.to()).match(query);\n          cursor.replace(text.replace(/\\$(\\d)/g, function (_, i) {\n            return match[i];\n          }));\n        } else cursor.replace(text);\n      }\n    });\n  }\n\n  function replace(cm, all) {\n    if (cm.getOption(\"readOnly\")) return;\n    var query = cm.getSelection() || getSearchState(cm).lastQuery;\n    var dialogText = '<span class=\"CodeMirror-search-label\">' + (all ? cm.phrase(\"Replace all:\") : cm.phrase(\"Replace:\")) + '</span>';\n    dialog(cm, dialogText + getReplaceQueryDialog(cm), dialogText, query, function (query) {\n      if (!query) return;\n      query = parseQuery(query);\n      dialog(cm, getReplacementQueryDialog(cm), cm.phrase(\"Replace with:\"), \"\", function (text) {\n        text = parseString(text);\n\n        if (all) {\n          replaceAll(cm, query, text);\n        } else {\n          clearSearch(cm);\n          var cursor = getSearchCursor(cm, query, cm.getCursor(\"from\"));\n\n          var advance = function () {\n            var start = cursor.from(),\n                match;\n\n            if (!(match = cursor.findNext())) {\n              cursor = getSearchCursor(cm, query);\n              if (!(match = cursor.findNext()) || start && cursor.from().line == start.line && cursor.from().ch == start.ch) return;\n            }\n\n            cm.setSelection(cursor.from(), cursor.to());\n            cm.scrollIntoView({\n              from: cursor.from(),\n              to: cursor.to()\n            });\n            confirmDialog(cm, getDoReplaceConfirm(cm), cm.phrase(\"Replace?\"), [function () {\n              doReplace(match);\n            }, advance, function () {\n              replaceAll(cm, query, text);\n            }]);\n          };\n\n          var doReplace = function (match) {\n            cursor.replace(typeof query == \"string\" ? text : text.replace(/\\$(\\d)/g, function (_, i) {\n              return match[i];\n            }));\n            advance();\n          };\n\n          advance();\n        }\n      });\n    });\n  }\n\n  CodeMirror.commands.find = function (cm) {\n    clearSearch(cm);\n    doSearch(cm);\n  };\n\n  CodeMirror.commands.findPersistent = function (cm) {\n    clearSearch(cm);\n    doSearch(cm, false, true);\n  };\n\n  CodeMirror.commands.findPersistentNext = function (cm) {\n    doSearch(cm, false, true, true);\n  };\n\n  CodeMirror.commands.findPersistentPrev = function (cm) {\n    doSearch(cm, true, true, true);\n  };\n\n  CodeMirror.commands.findNext = doSearch;\n\n  CodeMirror.commands.findPrev = function (cm) {\n    doSearch(cm, true);\n  };\n\n  CodeMirror.commands.clearSearch = clearSearch;\n  CodeMirror.commands.replace = replace;\n\n  CodeMirror.commands.replaceAll = function (cm) {\n    replace(cm, true);\n  };\n});","map":{"version":3,"sources":["/home/dylan/scaffold-eth/node_modules/codemirror/addon/search/search.js"],"names":["mod","exports","module","require","define","amd","CodeMirror","searchOverlay","query","caseInsensitive","RegExp","replace","global","source","ignoreCase","token","stream","lastIndex","pos","match","exec","string","index","length","skipToEnd","SearchState","posFrom","posTo","lastQuery","overlay","getSearchState","cm","state","search","queryCaseInsensitive","toLowerCase","getSearchCursor","caseFold","multiline","persistentDialog","text","deflt","onEnter","onKeyDown","openDialog","value","selectValueOnOpen","closeOnEnter","onClose","clearSearch","dialog","shortText","f","prompt","confirmDialog","fs","openConfirm","confirm","parseString","ch","parseQuery","isRE","indexOf","e","test","startSearch","queryText","removeOverlay","addOverlay","showMatchesOnScrollbar","annotate","clear","doSearch","rev","persistent","immediate","findNext","q","getSelection","hiding","searchNext","event","e_stop","getCursor","style","opacity","shiftKey","_","to","line","document","querySelector","display","wrapper","getBoundingClientRect","bottom","cursorCoords","top","getQueryDialog","keyName","extra","getOption","cmd","keyMap","execCommand","operation","callback","cursor","find","Pos","lastLine","firstLine","setSelection","from","scrollIntoView","phrase","getReplaceQueryDialog","getReplacementQueryDialog","getDoReplaceConfirm","replaceAll","getRange","i","all","dialogText","advance","start","doReplace","commands","findPersistent","findPersistentNext","findPersistentPrev","findPrev"],"mappings":"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","sourcesContent":["// CodeMirror, copyright (c) by Marijn Haverbeke and others\n// Distributed under an MIT license: https://codemirror.net/LICENSE\n\n// Define search commands. Depends on dialog.js or another\n// implementation of the openDialog method.\n\n// Replace works a little oddly -- it will do the replace on the next\n// Ctrl-G (or whatever is bound to findNext) press. You prevent a\n// replace by making sure the match is no longer selected when hitting\n// Ctrl-G.\n\n(function(mod) {\n  if (typeof exports == \"object\" && typeof module == \"object\") // CommonJS\n    mod(require(\"../../lib/codemirror\"), require(\"./searchcursor\"), require(\"../dialog/dialog\"));\n  else if (typeof define == \"function\" && define.amd) // AMD\n    define([\"../../lib/codemirror\", \"./searchcursor\", \"../dialog/dialog\"], mod);\n  else // Plain browser env\n    mod(CodeMirror);\n})(function(CodeMirror) {\n  \"use strict\";\n\n  function searchOverlay(query, caseInsensitive) {\n    if (typeof query == \"string\")\n      query = new RegExp(query.replace(/[\\-\\[\\]\\/\\{\\}\\(\\)\\*\\+\\?\\.\\\\\\^\\$\\|]/g, \"\\\\$&\"), caseInsensitive ? \"gi\" : \"g\");\n    else if (!query.global)\n      query = new RegExp(query.source, query.ignoreCase ? \"gi\" : \"g\");\n\n    return {token: function(stream) {\n      query.lastIndex = stream.pos;\n      var match = query.exec(stream.string);\n      if (match && match.index == stream.pos) {\n        stream.pos += match[0].length || 1;\n        return \"searching\";\n      } else if (match) {\n        stream.pos = match.index;\n      } else {\n        stream.skipToEnd();\n      }\n    }};\n  }\n\n  function SearchState() {\n    this.posFrom = this.posTo = this.lastQuery = this.query = null;\n    this.overlay = null;\n  }\n\n  function getSearchState(cm) {\n    return cm.state.search || (cm.state.search = new SearchState());\n  }\n\n  function queryCaseInsensitive(query) {\n    return typeof query == \"string\" && query == query.toLowerCase();\n  }\n\n  function getSearchCursor(cm, query, pos) {\n    // Heuristic: if the query string is all lowercase, do a case insensitive search.\n    return cm.getSearchCursor(query, pos, {caseFold: queryCaseInsensitive(query), multiline: true});\n  }\n\n  function persistentDialog(cm, text, deflt, onEnter, onKeyDown) {\n    cm.openDialog(text, onEnter, {\n      value: deflt,\n      selectValueOnOpen: true,\n      closeOnEnter: false,\n      onClose: function() { clearSearch(cm); },\n      onKeyDown: onKeyDown\n    });\n  }\n\n  function dialog(cm, text, shortText, deflt, f) {\n    if (cm.openDialog) cm.openDialog(text, f, {value: deflt, selectValueOnOpen: true});\n    else f(prompt(shortText, deflt));\n  }\n\n  function confirmDialog(cm, text, shortText, fs) {\n    if (cm.openConfirm) cm.openConfirm(text, fs);\n    else if (confirm(shortText)) fs[0]();\n  }\n\n  function parseString(string) {\n    return string.replace(/\\\\([nrt\\\\])/g, function(match, ch) {\n      if (ch == \"n\") return \"\\n\"\n      if (ch == \"r\") return \"\\r\"\n      if (ch == \"t\") return \"\\t\"\n      if (ch == \"\\\\\") return \"\\\\\"\n      return match\n    })\n  }\n\n  function parseQuery(query) {\n    var isRE = query.match(/^\\/(.*)\\/([a-z]*)$/);\n    if (isRE) {\n      try { query = new RegExp(isRE[1], isRE[2].indexOf(\"i\") == -1 ? \"\" : \"i\"); }\n      catch(e) {} // Not a regular expression after all, do a string search\n    } else {\n      query = parseString(query)\n    }\n    if (typeof query == \"string\" ? query == \"\" : query.test(\"\"))\n      query = /x^/;\n    return query;\n  }\n\n  function startSearch(cm, state, query) {\n    state.queryText = query;\n    state.query = parseQuery(query);\n    cm.removeOverlay(state.overlay, queryCaseInsensitive(state.query));\n    state.overlay = searchOverlay(state.query, queryCaseInsensitive(state.query));\n    cm.addOverlay(state.overlay);\n    if (cm.showMatchesOnScrollbar) {\n      if (state.annotate) { state.annotate.clear(); state.annotate = null; }\n      state.annotate = cm.showMatchesOnScrollbar(state.query, queryCaseInsensitive(state.query));\n    }\n  }\n\n  function doSearch(cm, rev, persistent, immediate) {\n    var state = getSearchState(cm);\n    if (state.query) return findNext(cm, rev);\n    var q = cm.getSelection() || state.lastQuery;\n    if (q instanceof RegExp && q.source == \"x^\") q = null\n    if (persistent && cm.openDialog) {\n      var hiding = null\n      var searchNext = function(query, event) {\n        CodeMirror.e_stop(event);\n        if (!query) return;\n        if (query != state.queryText) {\n          startSearch(cm, state, query);\n          state.posFrom = state.posTo = cm.getCursor();\n        }\n        if (hiding) hiding.style.opacity = 1\n        findNext(cm, event.shiftKey, function(_, to) {\n          var dialog\n          if (to.line < 3 && document.querySelector &&\n              (dialog = cm.display.wrapper.querySelector(\".CodeMirror-dialog\")) &&\n              dialog.getBoundingClientRect().bottom - 4 > cm.cursorCoords(to, \"window\").top)\n            (hiding = dialog).style.opacity = .4\n        })\n      };\n      persistentDialog(cm, getQueryDialog(cm), q, searchNext, function(event, query) {\n        var keyName = CodeMirror.keyName(event)\n        var extra = cm.getOption('extraKeys'), cmd = (extra && extra[keyName]) || CodeMirror.keyMap[cm.getOption(\"keyMap\")][keyName]\n        if (cmd == \"findNext\" || cmd == \"findPrev\" ||\n          cmd == \"findPersistentNext\" || cmd == \"findPersistentPrev\") {\n          CodeMirror.e_stop(event);\n          startSearch(cm, getSearchState(cm), query);\n          cm.execCommand(cmd);\n        } else if (cmd == \"find\" || cmd == \"findPersistent\") {\n          CodeMirror.e_stop(event);\n          searchNext(query, event);\n        }\n      });\n      if (immediate && q) {\n        startSearch(cm, state, q);\n        findNext(cm, rev);\n      }\n    } else {\n      dialog(cm, getQueryDialog(cm), \"Search for:\", q, function(query) {\n        if (query && !state.query) cm.operation(function() {\n          startSearch(cm, state, query);\n          state.posFrom = state.posTo = cm.getCursor();\n          findNext(cm, rev);\n        });\n      });\n    }\n  }\n\n  function findNext(cm, rev, callback) {cm.operation(function() {\n    var state = getSearchState(cm);\n    var cursor = getSearchCursor(cm, state.query, rev ? state.posFrom : state.posTo);\n    if (!cursor.find(rev)) {\n      cursor = getSearchCursor(cm, state.query, rev ? CodeMirror.Pos(cm.lastLine()) : CodeMirror.Pos(cm.firstLine(), 0));\n      if (!cursor.find(rev)) return;\n    }\n    cm.setSelection(cursor.from(), cursor.to());\n    cm.scrollIntoView({from: cursor.from(), to: cursor.to()}, 20);\n    state.posFrom = cursor.from(); state.posTo = cursor.to();\n    if (callback) callback(cursor.from(), cursor.to())\n  });}\n\n  function clearSearch(cm) {cm.operation(function() {\n    var state = getSearchState(cm);\n    state.lastQuery = state.query;\n    if (!state.query) return;\n    state.query = state.queryText = null;\n    cm.removeOverlay(state.overlay);\n    if (state.annotate) { state.annotate.clear(); state.annotate = null; }\n  });}\n\n\n  function getQueryDialog(cm)  {\n    return '<span class=\"CodeMirror-search-label\">' + cm.phrase(\"Search:\") + '</span> <input type=\"text\" style=\"width: 10em\" class=\"CodeMirror-search-field\"/> <span style=\"color: #888\" class=\"CodeMirror-search-hint\">' + cm.phrase(\"(Use /re/ syntax for regexp search)\") + '</span>';\n  }\n  function getReplaceQueryDialog(cm) {\n    return ' <input type=\"text\" style=\"width: 10em\" class=\"CodeMirror-search-field\"/> <span style=\"color: #888\" class=\"CodeMirror-search-hint\">' + cm.phrase(\"(Use /re/ syntax for regexp search)\") + '</span>';\n  }\n  function getReplacementQueryDialog(cm) {\n    return '<span class=\"CodeMirror-search-label\">' + cm.phrase(\"With:\") + '</span> <input type=\"text\" style=\"width: 10em\" class=\"CodeMirror-search-field\"/>';\n  }\n  function getDoReplaceConfirm(cm) {\n    return '<span class=\"CodeMirror-search-label\">' + cm.phrase(\"Replace?\") + '</span> <button>' + cm.phrase(\"Yes\") + '</button> <button>' + cm.phrase(\"No\") + '</button> <button>' + cm.phrase(\"All\") + '</button> <button>' + cm.phrase(\"Stop\") + '</button> ';\n  }\n\n  function replaceAll(cm, query, text) {\n    cm.operation(function() {\n      for (var cursor = getSearchCursor(cm, query); cursor.findNext();) {\n        if (typeof query != \"string\") {\n          var match = cm.getRange(cursor.from(), cursor.to()).match(query);\n          cursor.replace(text.replace(/\\$(\\d)/g, function(_, i) {return match[i];}));\n        } else cursor.replace(text);\n      }\n    });\n  }\n\n  function replace(cm, all) {\n    if (cm.getOption(\"readOnly\")) return;\n    var query = cm.getSelection() || getSearchState(cm).lastQuery;\n    var dialogText = '<span class=\"CodeMirror-search-label\">' + (all ? cm.phrase(\"Replace all:\") : cm.phrase(\"Replace:\")) + '</span>';\n    dialog(cm, dialogText + getReplaceQueryDialog(cm), dialogText, query, function(query) {\n      if (!query) return;\n      query = parseQuery(query);\n      dialog(cm, getReplacementQueryDialog(cm), cm.phrase(\"Replace with:\"), \"\", function(text) {\n        text = parseString(text)\n        if (all) {\n          replaceAll(cm, query, text)\n        } else {\n          clearSearch(cm);\n          var cursor = getSearchCursor(cm, query, cm.getCursor(\"from\"));\n          var advance = function() {\n            var start = cursor.from(), match;\n            if (!(match = cursor.findNext())) {\n              cursor = getSearchCursor(cm, query);\n              if (!(match = cursor.findNext()) ||\n                  (start && cursor.from().line == start.line && cursor.from().ch == start.ch)) return;\n            }\n            cm.setSelection(cursor.from(), cursor.to());\n            cm.scrollIntoView({from: cursor.from(), to: cursor.to()});\n            confirmDialog(cm, getDoReplaceConfirm(cm), cm.phrase(\"Replace?\"),\n                          [function() {doReplace(match);}, advance,\n                           function() {replaceAll(cm, query, text)}]);\n          };\n          var doReplace = function(match) {\n            cursor.replace(typeof query == \"string\" ? text :\n                           text.replace(/\\$(\\d)/g, function(_, i) {return match[i];}));\n            advance();\n          };\n          advance();\n        }\n      });\n    });\n  }\n\n  CodeMirror.commands.find = function(cm) {clearSearch(cm); doSearch(cm);};\n  CodeMirror.commands.findPersistent = function(cm) {clearSearch(cm); doSearch(cm, false, true);};\n  CodeMirror.commands.findPersistentNext = function(cm) {doSearch(cm, false, true, true);};\n  CodeMirror.commands.findPersistentPrev = function(cm) {doSearch(cm, true, true, true);};\n  CodeMirror.commands.findNext = doSearch;\n  CodeMirror.commands.findPrev = function(cm) {doSearch(cm, true);};\n  CodeMirror.commands.clearSearch = clearSearch;\n  CodeMirror.commands.replace = replace;\n  CodeMirror.commands.replaceAll = function(cm) {replace(cm, true);};\n});\n"]},"metadata":{},"sourceType":"script"}